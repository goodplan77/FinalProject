<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="board">

	<!--일반 회원용 -->
	
	<!-- 일반 게시판 -->
	<select id="selectBoards" resultType="Board">
		SELECT BOARD_NO, USER_NO, TITLE, CONTENT, BOARD_CODE, TO_CHAR(ENROLL_DATE, 'YYYY-MM-DD') AS ENROLL_DATE, MODIFY_DATE, VIEWS, STATUS, DETAIL_STATUS, LIKES
		FROM BOARD
		WHERE BOARD_CODE = 'C' AND STATUS ='Y'
		ORDER BY BOARD_NO DESC
	</select>
	
	<!-- 중고 게시판 -->
	<select id="usedList" resultType="Board">
		SELECT BOARD_NO, USER_NO, TITLE, CONTENT, BOARD_CODE, TO_CHAR(ENROLL_DATE, 'YYYY-MM-DD') AS ENROLL_DATE, MODIFY_DATE, VIEWS, STATUS, DETAIL_STATUS, LIKES
		FROM BOARD
		WHERE BOARD_CODE = 'S' AND STATUS ='Y'
		ORDER BY BOARD_NO DESC
	</select>
	
	<!-- 입양 게시판 -->
	<select id="adoptList" resultType="Board">
		SELECT BOARD_NO, USER_NO, TITLE, CONTENT, BOARD_CODE, TO_CHAR(ENROLL_DATE, 'YYYY-MM-DD') AS ENROLL_DATE, MODIFY_DATE, VIEWS, STATUS, DETAIL_STATUS, LIKES
		FROM BOARD
		WHERE BOARD_CODE = 'A' AND STATUS ='Y'
		ORDER BY BOARD_NO DESC
	</select>
	
	<!-- 실종 게시판 -->
	<select id="missingList" resultType="Board">
		SELECT BOARD_NO, USER_NO, TITLE, CONTENT, BOARD_CODE, TO_CHAR(ENROLL_DATE, 'YYYY-MM-DD') AS ENROLL_DATE, MODIFY_DATE, VIEWS, STATUS, DETAIL_STATUS, LIKES
		FROM BOARD
		WHERE BOARD_CODE = 'M' AND STATUS ='Y'
		ORDER BY BOARD_NO DESC
	</select>
	
	
	
	
	
	
	
	<!-- 게시글 등록 -->
	<insert id="insertBoard" useGeneratedKeys="true">
	
		<selectKey keyProperty="boardNo" resultType="int" order="BEFORE">
			SELECT SEQ_BOARD.NEXTVAL
			FROM DUAL
		</selectKey>
	
		INSERT INTO BOARD
		VALUES(
			#{boardNo},
			10,
			#{title},
			#{content},
			#{boardCode},
			DEFAULT,
			DEFAULT,
			0,
			'Y',
			'P',
			0
		)
	</insert>
	
	<insert id="insertImage">
		INSERT INTO BOARD_IMG (IMG_NO, BOARD_NO, ORIGIN_NAME)
		VALUES(
			SEQ_BOARD_IMG.NEXTVAL,
			#{boardNo},
			#{originName}
		)
	</insert> 
	
	
	
	
	<!-- 게시글 상세조회 -->
	<resultMap id="boardResultSet" type="board">
	    <id column="BOARD_NO" property="boardNo" />
	    <result column="USER_NO" property="userNo" />
	    <result column="TITLE" property="title" />
	    <result column="CONTENT" property="content" />
	    <result column="BOARD_CODE" property="boardCode" />
	    <result column="ENROLL_DATE" property="enrollDate" />
	    <result column="MODIFY_DATE" property="modifyDate" />
	    <result column="VIEWS" property="views" />
	    <result column="STATUS" property="status" />
	    <result column="DETAIL_STATUS" property="detailStatus" />
	    <result column="LIKES" property="likes" />
	    <collection property="boardImg" ofType="boardImg">
	        <result column="IMG_NO" property="imgNo" />
	        <result column="ORIGIN_NAME" property="originName" />
	        <result column="CHANGE_NAME" property="changeName" />
	    </collection>
	</resultMap>

	
	
	<select id="boardDetail" resultMap="boardResultSet">
		SELECT 
			B.BOARD_NO,
			B.USER_NO,
			B.TITLE,
			B.CONTENT,
			B.BOARD_CODE, 
			TO_CHAR(B.ENROLL_DATE, 'YYYY.MM.DD') AS ENROLL_DATE, 
			B.MODIFY_DATE, 
			B.VIEWS,
			B.STATUS, 
			B.DETAIL_STATUS, 
			B.LIKES,
			BI.IMG_NO,
			BI.ORIGIN_NAME,
			BI.CHANGE_NAME
		FROM BOARD B
		LEFT JOIN BOARD_IMG BI ON (B.BOARD_NO=BI.BOARD_NO)
		WHERE B.BOARD_NO = #{boardNo}
	</select>

	<!-- 댓글 등록 -->
	<insert id="insertComment" useGeneratedKeys="true">
	
		<selectKey keyProperty="commentNo" resultType="int" order="BEFORE">
			SELECT SEQ_COMMENT.NEXTVAL
			FROM DUAL
		</selectKey>
	
		INSERT INTO "COMMENT"(
			COMMENT_NO,
			BOARD_NO,
			USER_NO,
			"CONTENT",
			COMMENT_DATE,
			MODIFY_DATE,
			STATUS
		) VALUES (
			#{commentNo},
			#{boardNo},
			#{userNo},
			#{content},
			SYSDATE,
			SYSDATE,
			'Y'
		)
	</insert>

	<!-- 검색 할 때 사용할 제목 -->
	<select id="selectBoardsTitle" resultType="Board">
	    SELECT BOARD_NO, USER_NO, TITLE, CONTENT, BOARD_CODE, 
	           TO_CHAR(ENROLL_DATE, 'YYYY-MM-DD') AS ENROLL_DATE, 
	           TO_CHAR(MODIFY_DATE, 'YYYY-MM-DD') AS MODIFY_DATE, 
	           VIEWS, STATUS, DETAIL_STATUS, LIKES
	    FROM BOARD
	    WHERE TITLE Like '%' || #{title} || '%'
	      AND STATUS = 'Y'
	    ORDER BY BOARD_NO DESC
	</select>
	
	



	<!--관리자용 -->
	
	
	
</mapper>